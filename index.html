<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Intelligence Lens Splitter</title>
    <style>
        :root { 
            --primary: #1a73e8; --success: #34a853; --error: #d93025;
            --bg: #f8f9fa; --text: #202124; --border: #dfe1e5;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); padding: 20px; color: var(--text); }
        .container { max-width: 750px; margin: auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        
        h2 { color: var(--primary); text-align: center; margin: 0; }
        .subtitle { text-align: center; font-size: 12px; color: #5f6368; margin-bottom: 20px; }

        textarea { 
            width: 100%; height: 120px; padding: 15px; border: 2px solid var(--border); 
            border-radius: 12px; font-size: 14px; box-sizing: border-box; transition: 0.3s;
            line-height: 1.5;
        }
        textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(26,115,232,0.15); }
        
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 14px; }
        .btn-process { background-color: var(--primary); color: white; flex: 2; }
        .btn-clear { background-color: #dadce0; color: #3c4043; flex: 1; }
        
        #outputArea { margin-top: 25px; display: none; }
        .action-bar { 
            background: #e8f0fe; padding: 12px; border-radius: 10px; border: 1px dashed var(--primary); 
            margin-bottom: 20px; display: flex; gap: 10px; justify-content: space-between;
        }
        
        .btn-contact { background-color: var(--success); color: white; padding: 8px 16px; font-size: 13px; border-radius: 6px; }
        .btn-copy-all { background-color: #3c4043; color: white; padding: 8px 16px; font-size: 13px; border-radius: 6px; }

        .result-card { border: 1px solid #e8eaed; border-radius: 12px; background: #fff; overflow: hidden; }
        .field-row { display: grid; grid-template-columns: 140px 1fr auto; align-items: center; padding: 12px 15px; border-bottom: 1px solid #f1f3f4; gap: 10px; }
        .field-row:last-child { border-bottom: none; }
        
        .label { font-weight: 700; color: #70757a; font-size: 11px; text-transform: uppercase; }
        .value { color: var(--text); font-size: 15px; padding: 6px; border-radius: 4px; border: 1px solid transparent; }
        .value[contenteditable="true"]:focus { outline: none; background: #fff; border-color: var(--primary); }
        
        .invalid { border: 1px solid var(--error) !important; color: var(--error); background: #fce8e6; }
        .copy-btn { background: #f1f3f4; color: #5f6368; padding: 6px 12px; font-size: 11px; border-radius: 6px; }
    </style>
</head>
<body>

<div class="container">
    <h2>AI Intelligence Data Splitter</h2>
    <div class="subtitle">Supports Mr/Mrs/Miss Merging & Single-Line Analysis</div>
    
    <textarea id="rawInput" placeholder="Paste data here... (e.g. 101 Mr. John Doe 9876543210)"></textarea>
    
    <div class="btn-group">
        <button class="btn-process" onclick="processData()">Analyze & Split</button>
        <button class="btn-clear" onclick="clearAll()">Clear</button>
    </div>

    <div id="outputArea">
        <div class="action-bar">
            <button class="btn-copy-all" onclick="copyFullData()">ðŸ“‹ Copy All Data</button>
            <button class="btn-contact" onclick="downloadVCF()">ðŸ’¾ Save Contact</button>
        </div>
        <div class="result-card" id="resultCard"></div>
    </div>
</div>

<script>
    let currentFields = [];

    const salutations = ["MR", "MRS", "MISS", "MS", "DR", "PROF"];

    function validateField(label, value) {
        if (!value || value === "N/A") return true;
        if (label.includes('ID') || label.includes('PHONE')) return /^\+?\d+$/.test(value.replace(/[\s-]/g, ''));
        if (label.includes('NAME') || label.includes('GENDER')) return /^[a-zA-Z\s\.]+$/.test(value);
        return true;
    }

    function cleanData(type, str) {
        if (!str) return "N/A";
        if (type === 'NUM') return str.replace(/\D/g, ''); 
        if (type === 'CHAR') {
            return str.replace(/[^a-zA-Z\s\.]/g, '').split(' ')
                      .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()).join(' ');
        }
        return str.trim();
    }

    function processData() {
        let input = document.getElementById('rawInput').value.trim();
        if (!input) return;

        let lines = input.split('\n').map(l => l.trim()).filter(l => l.length > 0);
        
        // --- 1. SINGLE LINE IDENTIFICATION ---
        // If only one line, try to split by ID (numbers) and Name (letters)
        if (lines.length === 1) {
            const pattern = /^(\d+)\s+(.*?)\s+(\+?\d[\d\s-]{7,})$/;
            const match = input.match(pattern);
            if (match) {
                lines = [match[1], match[2], match[3]];
            }
        }

        // --- 2. SALUTATION MERGING ---
        let mergedLines = [];
        for (let i = 0; i < lines.length; i++) {
            let current = lines[i];
            let cleanUpper = current.replace(/\./g, '').toUpperCase();
            
            if (salutations.includes(cleanUpper) && i + 1 < lines.length) {
                mergedLines.push(current + " " + lines[i+1]);
                i++; // Skip next line
            } else {
                mergedLines.push(current);
            }
        }

        // --- 3. GENDER & DATA EXTRACTION ---
        let phoneNumbers = [];
        let finalOtherLines = [];
        let detectedGender = "N/A";

        mergedLines.forEach(line => {
            const up = line.toUpperCase();
            // Phone check
            const phones = line.match(/(\+?\d[\d\s\-]{7,}\d)/g);
            if (phones) {
                phoneNumbers.push(...phones);
            } 
            // Gender check from Salutation
            else if (up.includes("MR ")) detectedGender = "Male";
            else if (up.includes("MRS ") || up.includes("MISS ") || up.includes("MS ")) detectedGender = "Female";
            else if (["MALE", "FEMALE", "M", "F"].includes(up)) {
                detectedGender = up.startsWith('M') ? "Male" : "Female";
            }
            else {
                finalOtherLines.push(line);
            }
        });

        // --- 4. FIELD ASSIGNMENT ---
        currentFields = [
            { label: 'ID (Numbers)', value: cleanData('NUM', finalOtherLines[0]) },
            { label: 'Name (Chars)', value: cleanData('CHAR', finalOtherLines[1] || finalOtherLines[0]) },
            { label: 'Gender (Chars)', value: detectedGender },
            { label: 'Address', value: finalOtherLines.slice(2).join(", ") || "N/A" }
        ];

        phoneNumbers.forEach((num, i) => {
            currentFields.push({ label: `Phone ${i+1} (Num)`, value: num.replace(/[^\d+]/g, '') });
        });

        renderDisplay();
    }

    function renderDisplay() {
        const card = document.getElementById('resultCard');
        card.innerHTML = currentFields.map((f, i) => `
            <div class="field-row">
                <span class="label">${f.label}</span>
                <div class="value ${validateField(f.label, f.value) ? '' : 'invalid'}" 
                     id="val-${i}" contenteditable="true" 
                     onblur="currentFields[${i}].value=this.innerText; this.classList.toggle('invalid', !validateField('${f.label}', this.innerText))">
                     ${f.value}
                </div>
                <button class="copy-btn" onclick="copySingle('val-${i}', this)">Copy</button>
            </div>
        `).join('');
        document.getElementById('outputArea').style.display = 'block';
    }

    function copyFullData() {
        const text = currentFields.map(f => `${f.label.split(' ')[0]}: ${f.value}`).join('\n');
        navigator.clipboard.writeText(text).then(() => alert("All Data Copied!"));
    }

    function downloadVCF() {
        const nameField = currentFields.find(f => f.label.includes('Name'));
        const name = nameField ? nameField.value : 'Contact';
        const phones = currentFields.filter(f => f.label.includes('Phone'));
        const gender = currentFields.find(f => f.label.includes('Gender'))?.value;

        let vcard = `BEGIN:VCARD\nVERSION:3.0\nFN:${name}\n`;
        phones.forEach(p => vcard += `TEL;TYPE=CELL:${p.value}\n`);
        if (gender !== "N/A") vcard += `NOTE:Gender: ${gender}\n`;
        vcard += `END:VCARD`;

        const blob = new Blob([vcard], { type: 'text/vcard' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${name.replace(/\s+/g, '_')}.vcf`;
        a.click();
    }

    function copySingle(id, btn) {
        navigator.clipboard.writeText(document.getElementById(id).innerText.trim());
        const old = btn.innerText;
        btn.innerText = "Done";
        setTimeout(() => btn.innerText = old, 800);
    }

    function clearAll() {
        document.getElementById('rawInput').value = '';
        document.getElementById('outputArea').style.display = 'none';
        currentFields = [];
    }
</script>

</body>
</html>
