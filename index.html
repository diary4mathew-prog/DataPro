<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligence Lens Splitter</title>
    <style>
        :root { 
            --primary: #1a73e8; --success: #34a853; --error: #d93025;
            --bg: #f8f9fa; --text: #202124; --border: #dfe1e5;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); padding: 20px; color: var(--text); }
        .container { max-width: 700px; margin: auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
        
        h2 { color: var(--primary); text-align: center; margin: 0; }
        .subtitle { text-align: center; font-size: 12px; color: #5f6368; margin-bottom: 20px; }

        textarea { 
            width: 100%; height: 120px; padding: 15px; border: 2px solid var(--border); 
            border-radius: 12px; font-size: 14px; box-sizing: border-box; transition: 0.3s;
        }
        textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(26,115,232,0.15); }
        
        .btn-group { display: flex; gap: 10px; margin-top: 15px; }
        button { padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 14px; }
        .btn-process { background-color: var(--primary); color: white; flex: 2; }
        .btn-clear { background-color: #dadce0; color: #3c4043; flex: 1; }
        
        #outputArea { margin-top: 25px; display: none; }
        .action-bar { 
            background: #e8f0fe; padding: 15px; border-radius: 10px; border: 1px dashed var(--primary); 
            margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; 
        }
        
        .btn-contact { background-color: var(--success); color: white; padding: 8px 16px; font-size: 13px; border-radius: 6px; }

        .result-card { border: 1px solid #e8eaed; border-radius: 12px; background: #fff; overflow: hidden; }
        .field-row { display: grid; grid-template-columns: 110px 1fr auto; align-items: center; padding: 12px 15px; border-bottom: 1px solid #f1f3f4; gap: 10px; }
        .field-row:last-child { border-bottom: none; }
        
        .label { font-weight: 700; color: #70757a; font-size: 11px; text-transform: uppercase; }
        .value { color: var(--text); font-size: 15px; padding: 5px; border-radius: 4px; border: 1px solid transparent; }
        .value[contenteditable="true"]:focus { outline: none; background: #fff; border-color: var(--primary); }
        
        /* Validation Styles */
        .invalid { border-color: var(--error) !important; color: var(--error); background: #fce8e6; }
        .error-msg { font-size: 10px; color: var(--error); display: none; margin-top: 2px; }
        .invalid + .error-msg { display: block; }

        .copy-btn { background: #f1f3f4; color: #5f6368; padding: 6px 12px; font-size: 11px; border-radius: 6px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Data Splitter Pro</h2>
    <div class="subtitle">Clean, Validate, and Save Contacts</div>
    
    <textarea id="rawInput" placeholder="Paste Lens data here (ID, Name, Gender, Address, Phone)..."></textarea>
    
    <div class="btn-group">
        <button class="btn-process" onclick="processData()">Clean & Validate</button>
        <button class="btn-clear" onclick="clearAll()">Clear</button>
    </div>

    <div id="outputArea">
        <div class="action-bar">
            <span style="font-weight:600; color:var(--primary)">âœ“ Data Validated</span>
            <button class="btn-contact" onclick="downloadVCF()">ðŸ’¾ Save to Contacts</button>
        </div>
        <div class="result-card" id="resultCard"></div>
    </div>
</div>

<script>
    let currentFields = [];

    function validate(type, value) {
        if (!value || value === "N/A") return true;
        switch(type) {
            case 'ID': return /^\d+$/.test(value); // Only numbers
            case 'NAME': 
            case 'GENDER': return /^[a-zA-Z\s]+$/.test(value); // Only characters
            case 'PHONE': return /^[\d\+\-\s]+$/.test(value); // Numbers and basic symbols
            default: return true;
        }
    }

    function cleanString(type, str) {
        if (!str) return "N/A";
        switch(type) {
            case 'ID': return str.replace(/\D/g, ''); // Strip non-numbers
            case 'NAME': 
            case 'GENDER': 
                let cleaned = str.replace(/[^a-zA-Z\s]/g, ''); // Strip non-letters
                return cleaned.toLowerCase().split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
            case 'PHONE': return str.replace(/[^\d+]/g, ''); // Keep digits and plus
            default: return str.trim();
        }
    }

    function processData() {
        const input = document.getElementById('rawInput').value;
        if (!input.trim()) return;

        let lines = input.split('\n').map(l => l.trim()).filter(l => l.length > 0);
        let phoneNumbers = [];
        let gender = "N/A";
        let otherLines = [];

        lines.forEach(line => {
            const up = line.toUpperCase();
            // Phone detection
            if (line.match(/(\+?\d[\d\s\-]{7,}\d)/g)) {
                phoneNumbers.push(...line.match(/(\+?\d[\d\s\-]{7,}\d)/g));
            } 
            // Gender detection
            else if (up === "MALE" || up === "FEMALE" || up === "M" || up === "F") {
                gender = cleanString('GENDER', up);
            } 
            else {
                otherLines.push(line);
            }
        });

        const id = cleanString('ID', otherLines[0]);
        const name = cleanString('NAME', otherLines[1]);
        const address = otherLines.slice(2).join(", ") || "N/A";

        currentFields = [
            { key: 'ID', label: 'ID (Numbers Only)', value: id },
            { key: 'NAME', label: 'Name (Chars Only)', value: name },
            { key: 'GENDER', label: 'Gender', value: gender },
            { key: 'ADDR', label: 'Address', value: address }
        ];

        phoneNumbers.forEach((num, i) => {
            currentFields.push({ key: 'PHONE', label: `Phone ${i+1}`, value: cleanString('PHONE', num) });
        });

        renderDisplay();
    }

    function renderDisplay() {
        const card = document.getElementById('resultCard');
        card.innerHTML = currentFields.map((f, i) => {
            const isValid = validate(f.key, f.value);
            return `
            <div class="field-row">
                <span class="label">${f.label}</span>
                <div>
                    <div class="value ${isValid ? '' : 'invalid'}" id="val-${i}" contenteditable="true" 
                         onblur="updateValue(${i}, this)">${f.value}</div>
                    <span class="error-msg">Invalid format for ${f.label}</span>
                </div>
                <button class="copy-btn" onclick="copySingle('val-${i}', this)">Copy</button>
            </div>
        `}).join('');
        document.getElementById('outputArea').style.display = 'block';
    }

    function updateValue(index, el) {
        currentFields[index].value = el.innerText.trim();
        const isValid = validate(currentFields[index].key, currentFields[index].value);
        el.classList.toggle('invalid', !isValid);
    }

    function downloadVCF() {
        const name = currentFields.find(f => f.key === 'NAME')?.value || 'Contact';
        const address = currentFields.find(f => f.key === 'ADDR')?.value || '';
        const gender = currentFields.find(f => f.key === 'GENDER')?.value || '';
        const phones = currentFields.filter(f => f.key === 'PHONE');

        let vcard = `BEGIN:VCARD\nVERSION:3.0\nFN:${name}\n`;
        phones.forEach(p => vcard += `TEL;TYPE=CELL:${p.value}\n`);
        if(address !== 'N/A') vcard += `ADR:;;${address};;;;\n`;
        vcard += `NOTE:Gender: ${gender}\nEND:VCARD`;

        const blob = new Blob([vcard], { type: 'text/vcard' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${name}.vcf`;
        a.click();
    }

    function copySingle(id, btn) {
        navigator.clipboard.writeText(document.getElementById(id).innerText.trim());
        const old = btn.innerText;
        btn.innerText = "Done";
        setTimeout(() => btn.innerText = old, 800);
    }

    function clearAll() {
        document.getElementById('rawInput').value = '';
        document.getElementById('outputArea').style.display = 'none';
    }
</script>

</body>
</html>
