<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Lens Splitter</title>
    <style>
        :root { 
            --primary: #1a73e8; 
            --success: #34a853; 
            --bg: #f8f9fa; 
            --text: #202124; 
            --border: #dfe1e5;
        }
        body { 
            font-family: 'Segoe UI', system-ui, sans-serif; 
            background-color: var(--bg); 
            padding: 20px; 
            color: var(--text); 
        }
        .container { 
            max-width: 700px; 
            margin: auto; 
            background: white; 
            padding: 25px; 
            border-radius: 16px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
        }
        
        h2 { 
            color: var(--primary); 
            text-align: center; 
            margin-top: 0; 
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            font-size: 12px;
            color: #5f6368;
            margin-bottom: 18px;
        }

        textarea { 
            width: 100%; 
            height: 120px; 
            padding: 15px; 
            border: 2px solid var(--border); 
            border-radius: 12px; 
            font-size: 14px; 
            box-sizing: border-box; 
            transition: border-color 0.3s, box-shadow 0.3s; 
        }
        textarea:focus { 
            border-color: var(--primary); 
            outline: none; 
            box-shadow: 0 0 0 3px rgba(26,115,232,0.15);
        }
        
        .hint {
            font-size: 11px;
            color: #5f6368;
            margin-top: 6px;
        }

        .btn-group { 
            display: flex; 
            gap: 10px; 
            margin-top: 15px; 
        }
        button { 
            padding: 14px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: 0.2s; 
            font-size: 14px; 
        }
        .btn-process { 
            background-color: var(--primary); 
            color: white; 
            flex: 1; 
        }
        .btn-clear { 
            background-color: #dadce0; 
            color: #3c4043; 
            flex: 1; 
        }
        .btn-process:hover {
            filter: brightness(1.05);
        }
        .btn-clear:hover {
            background-color: #c4c7cc;
        }
        
        /* Full Data Copy Section */
        #outputArea { 
            margin-top: 25px; 
            display: none; 
        }
        .full-copy-box { 
            background: #e8f0fe; 
            padding: 15px; 
            border-radius: 10px; 
            border: 1px dashed var(--primary); 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            gap: 10px;
            flex-wrap: wrap;
        }
        .full-copy-box span { 
            font-weight: 600; 
            color: var(--primary); 
            font-size: 13px;
        }
        .full-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .small-btn {
            padding: 8px 14px;
            font-size: 12px;
            border-radius: 6px;
        }

        /* Results Display */
        .result-card { 
            border: 1px solid #e8eaed; 
            border-radius: 12px; 
            background: #fff; 
            overflow: hidden; 
        }
        .field-row { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 12px 15px; 
            border-bottom: 1px solid #f1f3f4; 
            gap: 10px;
        }
        .field-row:last-child { 
            border-bottom: none; 
        }
        .label { 
            font-weight: 700; 
            color: #70757a; 
            width: 110px; 
            font-size: 11px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        .value { 
            flex-grow: 1; 
            margin: 0 5px; 
            color: var(--text); 
            font-size: 15px; 
            padding: 4px 6px;
            border-radius: 6px;
            min-height: 20px;
        }
        .value[contenteditable="true"] {
            outline: none;
            border: 1px solid transparent;
        }
        .value[contenteditable="true"]:focus {
            border-color: rgba(26,115,232,0.4);
            background: #f8f9ff;
        }
        
        .copy-btn { 
            background: #f1f3f4; 
            color: #5f6368; 
            padding: 6px 15px; 
            font-size: 12px; 
            border-radius: 6px; 
            flex: none; 
            white-space: nowrap;
        }
        .copy-btn:hover { 
            background: var(--success); 
            color: white; 
        }
    </style>
</head>
<body>

<div class="container">
    <h2>Data Splitter</h2>
    <div class="subtitle">Paste text from Google Lens – get clean ID, Name, Address & Phones.</div>
    
    <textarea id="rawInput" placeholder="Paste Lens data here..."></textarea>
    <div class="hint">Tip: Press Ctrl + Enter (or Cmd + Enter on Mac) to Clean & Split.</div>
    
    <div class="btn-group">
        <button class="btn-process" onclick="processData()">Clean & Split</button>
        <button class="btn-clear" onclick="clearAll()">Clear All</button>
    </div>

    <div id="outputArea">
        <div class="full-copy-box">
            <span>✨ Processed Results – you can edit any field before copying</span>
            <div class="full-actions">
                <button class="btn-process small-btn" onclick="copyFullData()">Copy Full Data</button>
                <button class="btn-process small-btn" style="background:#185abc" onclick="copyCsvRow()">Copy as CSV Row</button>
            </div>
        </div>
        
        <div class="result-card" id="resultCard"></div>
    </div>
</div>

<script>
    let currentFields = [];

    // Helper: extract phone-like substrings from a line
    function extractPhonesFromLine(line) {
        // Match patterns like: +91 98765 43210, 98765-43210, 09876543210 etc.
        const matches = line.match(/(\+?\d[\d\s\-]{6,}\d)/g);
        if (!matches) return [];
        return matches.map(m => m.trim());
    }

    function processData() {
        const input = document.getElementById('rawInput').value;
        if (!input.trim()) return;

        // 0. Split & clean lines
        let lines = input
            .split('\n')
            .map(line => line.replace(/\.\./g, '').trim())
            .filter(line => line.length > 0);

        if (lines.length < 1) return;

        let phoneNumbers = [];
        let otherLines = [];

        // 1. Separate possible phone content from other lines
        lines.forEach(line => {
            const phonesInLine = extractPhonesFromLine(line);
            if (phonesInLine.length > 0) {
                phoneNumbers.push(...phonesInLine);
                // If you want to keep remaining part of line as address, you could compute it here.
                // For now we assume entire line is mainly phone info.
            } else {
                otherLines.push(line);
            }
        });

        // 2. Extract ID and Name
        const id = otherLines[0] || "N/A";
        const hasShortTitle = otherLines[1] && otherLines[1].length < 5;
        const name = hasShortTitle 
            ? ((otherLines[1] || "") + " " + (otherLines[2] || "")).trim() || "N/A"
            : (otherLines[1] || "N/A");
        
        // 3. Extract Address (everything else)
        const addressStart = hasShortTitle ? 3 : 2;
        const address = otherLines.slice(addressStart).join(", ") || "N/A";

        // Build Field Array
        currentFields = [
            { label: 'ID', value: id },
            { label: 'Name', value: name },
            { label: 'Address', value: address }
        ];

        // Add Phones dynamically
        phoneNumbers.forEach((num, index) => {
            currentFields.push({ 
                label: phoneNumbers.length > 1 ? `Phone ${index + 1}` : 'Phone', 
                value: num 
            });
        });

        renderDisplay();
    }

    function renderDisplay() {
        const card = document.getElementById('resultCard');
        card.innerHTML = currentFields.map((f, i) => `
            <div class="field-row">
                <span class="label">${f.label}</span>
                <span class="value" id="val-${i}" contenteditable="true">${f.value}</span>
                <button class="copy-btn" onclick="copySingle('val-${i}', this)">Copy</button>
            </div>
        `).join('');
        document.getElementById('outputArea').style.display = 'block';
    }

    function copyFullData() {
        // Read back live (in case user edited fields)
        const fullText = currentFields.map((f, i) => {
            const el = document.getElementById(`val-${i}`);
            const val = el ? el.innerText.trim() : f.value;
            return `${f.label}: ${val}`;
        }).join('\n');

        navigator.clipboard.writeText(fullText)
            .then(() => alert("Full data copied to clipboard!"))
            .catch(() => alert("Unable to access clipboard in this browser."));
    }

    function copyCsvRow() {
        // Read back live values and build CSV row
        const values = currentFields.map((f, i) => {
            const el = document.getElementById(`val-${i}`);
            const val = el ? el.innerText.trim() : f.value;
            // Escape quotes for CSV
            const escaped = val.replace(/"/g, '""');
            return `"${escaped}"`;
        });

        const csvLine = values.join(',');
        navigator.clipboard.writeText(csvLine)
            .then(() => alert("CSV row copied to clipboard!"))
            .catch(() => alert("Unable to access clipboard in this browser."));
    }

    function copySingle(id, btn) {
        const el = document.getElementById(id);
        if (!el) return;
        const text = el.innerText.trim();

        navigator.clipboard.writeText(text).then(() => {
            const oldText = btn.innerText;
            const oldBg = btn.style.background;
            const oldColor = btn.style.color;

            btn.innerText = "Done";
            btn.style.background = "#34a853";
            btn.style.color = "white";
            setTimeout(() => {
                btn.innerText = oldText;
                btn.style.background = oldBg || "#f1f3f4";
                btn.style.color = oldColor || "#5f6368";
            }, 800);
        }).catch(() => {
            alert("Unable to access clipboard in this browser.");
        });
    }

    function clearAll() {
        document.getElementById('rawInput').value = '';
        document.getElementById('outputArea').style.display = 'none';
        currentFields = [];
    }

    // Keyboard shortcut: Ctrl+Enter / Cmd+Enter to process
    document.getElementById('rawInput').addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            processData();
        }
    });
</script>

</body>
</html>
